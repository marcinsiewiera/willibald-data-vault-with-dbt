
  
    

        create or replace  table WILLIBALD_DATA_VAULT_WITH_DBT.dwh_04_rv.deliveryservice_ws_s
         as
        (



    
    
-----------------------------------------------------------------------------------------------
--                                                                                      ( )  --
--                                                                                     //    --
--                                                                               ( )=( o )   --
--  #####   #####     #    #       ####### ####### ######  ####### #######             \\    --
-- #     # #     #   # #   #       #       #       #     # #       #                    ( )  --
-- #       #        #   #  #       #       #       #     # #       #                         --
--  #####  #       #     # #       #####   #####   ######  #####   #####                     --
--       # #       ####### #       #       #       #   #   #       #                         --
-- #     # #     # #     # #       #       #       #    #  #       #                         --
--  #####   #####  #     # ####### ####### #       #     # ####### #######                   --
-----------------------------------------------------------------------------------------------
--              Generated by datavault4dbt by Scalefree International GmbH                   --
-----------------------------------------------------------------------------------------------

WITH


source_data AS (

    SELECT
        hk_deliveryservice_h,
        hd_deliveryservice_ws_s as hd_deliveryservice_ws_s,
        
        rsrc,
        ldts,
        email,
        fax,
        hausnummer,
        land,
        name,
        ort,
        plz,
        strasse,
        telefon
    FROM WILLIBALD_DATA_VAULT_WITH_DBT.dwh_03_stage.stg_webshop_lieferdienst
),




deduplicated_numbered_source AS (

    SELECT
    hk_deliveryservice_h,
    hd_deliveryservice_ws_s,
    
        rsrc,
        ldts,
        email,
        fax,
        hausnummer,
        land,
        name,
        ort,
        plz,
        strasse,
        telefon
    
    FROM source_data
    QUALIFY
        CASE
            WHEN hd_deliveryservice_ws_s = LAG(hd_deliveryservice_ws_s) OVER(PARTITION BY hk_deliveryservice_h ORDER BY ldts) THEN FALSE
            ELSE TRUE
        END
),


records_to_insert AS (

    SELECT
    hk_deliveryservice_h,
    hd_deliveryservice_ws_s,
    
        rsrc,
        ldts,
        email,
        fax,
        hausnummer,
        land,
        name,
        ort,
        plz,
        strasse,
        telefon
    FROM deduplicated_numbered_source

    )

SELECT * FROM records_to_insert
        );
      
  